# 安全与合规说明

## 1. 安全目标
- 保护演讲者与观众的实时通信，防止未授权访问。
- 保障后台管理操作安全，防止活动数据泄露或篡改。
- 防止 API Key、令牌、二维码链接等敏感信息泄露。

## 2. 认证与授权
- 后台管理员：JWT + HTTPS，密码复杂度要求，建议启用 2FA。
- 演讲者与观众：通过后台生成的短期令牌或邀请码，使用 JWT 签名（RS256）。
- 二维码链接包含活动 ID 与邀请码参数，扫码后需向后端换取 WebSocket token 才能访问字幕。
- WebSocket 连接：握手阶段校验令牌与活动状态，连接过程中定期验证。
- 权限隔离：不同角色访问不同资源路径，服务端进行二次校验。

## 3. 数据传输安全
- 全站启用 HTTPS/WSS，TLS 1.2+。
- 禁止明文传输密码、令牌或 API Key。
- 关键响应头配置：`Strict-Transport-Security`、`X-Content-Type-Options`、`X-Frame-Options`、`Content-Security-Policy`。

## 4. 数据存储与隐私
- 当前阶段不落地存储演讲内容与翻译结果，仅在内存中保留短期缓存。
- 如需持久化，需明确用户隐私策略与数据保留期限。
- 活动信息、令牌、二维码状态存储于数据库或 Redis 时需开启访问控制与加密（如启用 Redis AUTH）。

## 5. 凭证管理
- Google 服务账户 JSON 与 JWT 私钥存放于服务器安全目录或 AWS Secrets Manager。
- 权限最小化：服务账户仅开放所需 API 权限。
- 定期轮换凭证，至少每 6 个月一次。
- 部署脚本避免将密钥写入仓库。

## 6. API 安全
- 速率限制：关键接口（生成令牌、登录、二维码失效/启用）启用速率限制（如 5 次/分钟）。
- 输入校验：后端对所有参数进行白名单校验，防止注入。
- 输出编码：对用户可见内容进行转义，防止 XSS。
- CSRF 防护：后台端接口使用 Bearer Token；如需 Cookie，开启 `SameSite=strict` 与 CSRF Token。
- 二维码失效操作应记录日志，并在接口返回中明确当前状态，避免旧链接继续传播。

## 7. 日志与审计
- 记录关键操作日志：登录、活动变更、令牌生成/失效、二维码生成/失效、错误事件。
- 日志中避免记录敏感数据（如完整 JWT、API Key、邀请码明文）。
- 保留 30 天日志便于审计，存储在安全位置（如 CloudWatch、ELK）。

## 8. 依赖安全
- 定期升级前后端依赖，使用 Dependabot 或 Renovate 自动提醒。
- 构建流程加入漏洞扫描（如 npm audit、gosec、Trivy）。
- Docker 镜像基于轻量化基础镜像，及时更新安全补丁。

## 9. 应急响应
- 建立安全事件响应流程：发现 → 评估 → 通知 → 修复 → 复盘。
- 若发现凭证或二维码链接泄露，可通过接口立即失效并生成新链接。
- 准备对外沟通过程（包含影响范围、补救措施）。

## 10. 合规考虑
- 注意 Google API 使用条款，确保调用合法。
- 若未来存储用户数据，需考虑 GDPR/中国网络安全法等法规，告知数据用途与保留策略。
- 对音频采集需明确用户授权范围，提供隐私声明。
